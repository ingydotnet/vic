<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>VIC by Selective Intellect</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <link rel="stylesheet" href="stylesheets/zenburn.css">
    <script src="javascripts/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/selectiveintellect/vic">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/selectiveintellect/vic/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/selectiveintellect/vic/tarball/master">TAR</a></li>
          <li class="title">DOWNLOAD SOURCE</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">
    <section>
        <div id="title">
        <p>VIC&trade; - A compiler for Microchip&#8217;s PIC&reg; Microcontrollers</p>
        <hr>
        <span class="credits left">Project sponsored by <a
        href="http://selectiveintellect.com">Selective Intellect</a></span>
        <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        <br/><br/>
        <span class="credits left"><a href="./index.html">Table of Contents</a></span>
        <span class="credits right"><a href="simulator.html">Prev</a>&nbsp;&nbsp;<a href="index.html">Next</a></span>
        </div>
<h1 id="examples">Examples</h1>

<p>This chapter lists a variety of examples demonstrating how to use VIC&trade;.
Most of these examples can be found in the <code>share/examples</code> folder in the source
code and in your installation.</p>

<p>Wherever necessary the code is explained. Most of the code is quite obvious and
very readable.</p>

<h2 id="helloworld">Hello World!</h2>

<p>This example lights up an LED and can be found in the file
<code>share/examples/helloworld.vic</code>. We also demonstrate how to verify everything
with a simulator <code>sim_assert</code> statement and other statements to visually display
the lighting up of the LED in the simulator interface.</p>

<pre><code>PIC P16F690;

# enable gpsim as a simulator
pragma simulator gpsim;

Main {
    digital_output RC0; # mark pin RC0 as output
    write RC0, 0x1; # write the value 1 to RC0
    sim_assert RC0 == 0x1, &quot;Pin RC0 should be 1&quot;;
}

Simulator {
    attach_led RC0;
    stop_after 1s;
    logfile &quot;helloworld.lxt&quot;;
    log RC0;
    scope RC0;
}
</code></pre>

<h2 id="synchronoustimedelays">Synchronous Time Delays</h2>

<p>This is a generic piece of code that can be used to test whether the <a href="functions.html#timemanagementfunctions"><code>delay</code>
functions</a> work as expected and can create the exact delay needed. That&#8217;s where
the simulators <a href="simulator.html#simulatorcontrol"><code>stopwatch</code> function</a> come in
handy. The code is available in the file <code>share/examples/delay.vic</code>.</p>

<pre><code>PIC P16F690;

Main {
    delay 1ms;
    sim_assert &quot;*** EARLY STOP ***&quot;;
}

Simulator {
    stopwatch 1ms;
}
</code></pre>

<h2 id="blinkinganled">Blinking an LED</h2>

<p>This example blinks an LED and can be found in the file
<code>share/examples/blinker.vic</code>.</p>

<pre><code>PIC P16F690;

# enable gpsim as a simulator
pragma simulator gpsim;

Main {
     digital_output RC0;
     Loop {
         write RC0, 1;
         delay 1s;
         write RC0, 0;
         delay 1s;
     }
}

Simulator {
    attach_led RC0, 1, 'green';
    stop_after 30s;
    logfile;
    log RC0;
}
</code></pre>

<h2 id="rotatingoverleds">Rotating over LEDs</h2>

<p>This example rotates the lighting up of an LED in a loop with a port connected
to 4 LEDs. It can be found in the file <code>share/examples/rotater.vic</code>.</p>

<pre><code>PIC P16F690;

# enable gpsim as a simulator
pragma simulator gpsim;

Main {
    digital_output PORTC;
    $display = 0x08; # create a 8-bit register by checking size
    sim_assert $display == 0x08, &quot;$display should be 0x08&quot;;
    Loop {
        write PORTC, $display;
        delay 100ms;
        # improve this depiction
        # circular rotate right by 1 bit
        ror $display, 1;
    }
}

Simulator {
    attach_led PORTC, 4; # attach 4 LEDs to PORTC on RC0-RC3;
    stop_after 60s;
    logfile &quot;rotater.lxt&quot;;
    log PORTC;
    scope PORTC;
}
</code></pre>

<h2 id="usinga7-segmentled">Using a 7-segment LED</h2>

<p>This example demonstrates how to use a simulator 7-segment LED, a look up table
and array indexing to periodically change digits in the LED. Note that the LED
look up table is specific to <code>gpsim</code>, and to use a real 7-segment LED these
values may have to be changed as per the chosen 7-segment LED. This is also
found in the source code as the file <code>share/examples/led7seg.vic</code>.</p>

<pre><code>PIC p16f690;

pragma variable export;
# enable gpsim as a simulator
pragma simulator gpsim;

Main {
    $led7 = table [ 0x3F, 0x06, 0x5B, 0x4F, 0x66, 0x6D,
              0x7D, 0x07, 0x7F, 0x67, 0x77, 0x7C, # this is gpsim specific
              0x58, 0x5E, 0x79, 0x71 ];
    $digit = 0;
    digital_output PORTA;
    digital_output PORTC;
    write PORTA, 0;
    Loop {
        write PORTC, $led7[$digit];
        $digit++;
        $digit &amp;= 0x0F; # bounds check
    }
}

Simulator {
    attach_led7seg RA0, PORTC;
    stop_after 5s;
}
</code></pre>

<h2 id="conditionalloops">Conditional Loops</h2>

<p>This example demonstrates how to use <a href="syntax.html#unconditionalloops">loops</a> and <a href="syntax.html#conditionalblocks">conditional blocks</a> in VIC&trade;.
It is available in the source code as the file <code>share/examples/conditional.vic</code>.
The simulator code is left as an exercise for the reader.</p>

<pre><code>PIC P16F690;

Main {
    digital_output PORTC;
    $var1 = TRUE;
    $var2 = FALSE;
    Loop {
        if $var1 != FALSE &amp;&amp; $var2 != FALSE {
            write PORTC, 1;
            $var1 = !$var2;
        } else if $var1 || $var2 {
            write PORTC, 2;
            $var2 = $var1;
        } else if !$var1 {
            write PORTC, 4;
            $var2 = !$var1;
        } else if $var2 {
            write PORTC, 4;
            $var2 = !$var1;
        } else {
            write PORTC, 8;
            $var1 = !$var2;
        };
        $var3 = 0xFF;
        while $var3 != 0 {
            $var3 &gt;&gt;= 1;
        }
    }
}
</code></pre>

<h2 id="breakingoutofnestedloops">Breaking Out of Nested Loops</h2>

<p>This example demonstrates how to use nested loops and the <a href="syntax.html#conditionalblocks"><code>break</code> and <code>continue</code>
statements</a> to change the execution logic. The simulator code is left as an
exercise to the reader. The code is available in the file
<code>share/examples/loopbreak.vic</code>.</p>

<pre><code>PIC P16F690;

Main {
    digital_output PORTC;
    Loop {
        $dummy = 0xFF;
        while $dummy != 0 {
            $dummy &gt;&gt;= 1;
            write PORTC, 1;
            if $dummy &lt;= 0x0F {
                break;
            }
        }
        while $dummy &gt; 0 {
            $dummy &gt;&gt;= 1;
            write PORTC, 3;
            continue;
        }
        if $dummy == TRUE {
            write PORTC, 2;
            break;
        } else {
            write PORTC, 4;
            continue;
        }
    }
    # we have broken from the loop
    while TRUE {
        write PORTC, 0xFF;
    }
}
</code></pre>

<h2 id="mathematicaloperations">Mathematical Operations</h2>

<p>This code demonstrates the various mathematical operations supported by
VIC&trade; along with verifying them using the simulator&#8217;s <a href="simulator.html#simulatorcontrol"><code>sim_assert</code>
function</a>. All the mathematics is done in 8-bit
mode and the code is available in the file <code>share/examples/math8bit.vic</code>.</p>

<pre><code>PIC P16F690;

pragma variable bits = 8;
pragma variable export;

Main {
    $var1 = 12345;
    sim_assert $var1 == 57, &quot;12345 was placed as 57 due to 8-bit mode&quot;;
    $var2 = 113;
    $var3 = $var2 + $var1;
    sim_assert $var3 == 170, &quot;57 + 113 = 170&quot;;
    $var3 = $var2 - $var1;
    sim_assert $var3 == 56, &quot;113 - 57 = 56&quot;;
    $var3 = $var2 * $var1;
    sim_assert $var3 == 41, &quot;113 * 57 = 41&quot;;
    $var2 = $var2 * 5;
    sim_assert $var2 == 53, &quot;113 * 5 = 565 =&gt; 53 in 8-bit mode&quot;;
    $var3 = $var2 / $var1;
    sim_assert $var3 == 0, &quot;53 / 57 = 0 in integer mathematics&quot;;
    $var3 = $var2 % $var1;
    sim_assert $var3 == 53, &quot;53 % 57 = 53&quot;;
    --$var3;
    sim_assert $var3 == 52, &quot;--53 = 52&quot;;
    ++$var3;
    sim_assert $var3 == 53, &quot;++52 = 53&quot;;
    $var4 = 64;
    $var4 -= $var1;
    sim_assert $var4 == 7, &quot;64 - 57 = 7&quot;;
    $var3 *= 3;
    sim_assert $var3 == 159, &quot;53 * 3 = 159&quot;;
    $var2 /= 5;
    sim_assert $var2 == 10, &quot;53 / 5 = 10&quot;;
    $var4 %= $var2;
    sim_assert $var4 == 7, &quot;7 % 10 = 7&quot;;
    $var4 = 64;
    $var4 ^= 0xFF;
    sim_assert $var4 == 0xBF, &quot;64 ^ 0xFF = 0xBF&quot;;
    $var4 |= 0x80;
    sim_assert $var4 == 0xBF, &quot;0xBF | 0x80 = 0xBF&quot;;
    $var4 &amp;= 0xAA;
    sim_assert $var4 == 0xAA, &quot;0xBF &amp; 0xAA = 0xAA&quot;;
    $var4 = $var4 &lt;&lt; 1;
    sim_assert $var4 == 84, &quot;0xAA &lt;&lt; 1 = 340 which is 84 in 8-bit mode&quot;;
    $var4 = $var4 &gt;&gt; 1;
    sim_assert $var4 == 42, &quot;84 &gt;&gt; 1 = 42&quot;;
    $var4 &lt;&lt;= 1;
    sim_assert $var4 == 84, &quot;42 &lt;&lt; 1 = 84&quot;;
    $var4 &gt;&gt;= 1;
    sim_assert $var4 == 42, &quot;84 &gt;&gt; 1 = 42&quot;;
    $var5 = $var1 - $var2 + $var3 * ($var4 + 8) / $var1;
    sim_assert $var5 == 47, &quot;57 - 10 + ((159 * (42 + 8)) &amp; 0xFF) / 57&quot;;
    $var7 = 13;
    $var5 = ($var1 + (($var3 * ($var4 + $var7) + 5) + $var2));
    sim_assert $var5 == 113,
        &quot;57 + (((159 * (42 + 13)) &amp; 0xFF + 5) + 10) = 113&quot;;
    $var6 = 19;
    $var8 = ($var1 + $var2) - ($var3 * $var4) / ($var5 % $var6);
    sim_assert $var8 == 66, &quot;(57 + 10) - ((159 * 42) &amp; 0xFF) / (113 % 19)&quot;;
    # sqrt is a modifier
    $var3 = sqrt $var4;
    sim_assert $var3 == 6,
        &quot;sqrt(42) = 6.4807 which is 6 in integer mathematics&quot;;
    sim_assert &quot;*** Completed the simulation ***&quot;;
}
</code></pre>

<h2 id="debouncingaswitch">Debouncing a Switch</h2>

<p>This brings us to the end of the list of examples.</p>
    <hr>
    <div id="title">
    <span class="credits left"><a href="./index.html">Table of Contents</a></span>
    <span class="credits right"><a href="simulator.html">Prev</a>&nbsp;&nbsp;<a href="index.html">Next</a></span>
    <br/><br/>
    <p style="font-size:14px;">Vikas N Kumar (<a href="https://github.com/vikasnkumar"
class="user-mention">@vikasnkumar</a>) is the author of
<strong>VIC&trade;</strong>. All copyrights belong to the author and Selective
Intellect LLC.</p>
    <p style="font-size:12px;">VIC&trade; is licensed under the <a
    href="http://dev.perl.org/licenses/">license terms of Perl</a>.
    <br/>
    The development of VIC&trade; is sponsored by <a
    href="http://selectiveintellect.com">Selective Intellect LLC.</a>
    </p>
    <p style="font-size:11px;">
        This page was last updated on 2014-10-26 15:11:42 -0400.
    </p>
    </div>
    </section>
    </div><!-- end wrapper -->
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
  </body>
