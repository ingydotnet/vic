<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>VIC by Selective Intellect</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/selectiveintellect/vic">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/selectiveintellect/vic/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/selectiveintellect/vic/tarball/master">TAR</a></li>
          <li class="title">DOWNLOAD SOURCE</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">
    <section>
        <div id="title">
        <p>VIC&trade; - A compiler for Microchip&#8217;s PIC&reg; Microcontrollers</p>
        <hr>
        <span class="credits left">Project sponsored by <a
        href="http://selectiveintellect.com">Selective Intellect</a></span>
        <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        <br/><br/>
        <span class="credits left"><a href="./index.html">Table of Contents</a></span>
        <span class="credits right"><a href="hardware.html">Prev</a>&nbsp;&nbsp;<a href="syntax.html">Next</a></span>
        </div>
<h1 id="gettingstartedwithvictrade">Getting Started With VIC&trade;</h1>

<p>Writing VIC&trade; code is similar to writing Bash scripts except for the fact
that there are no functions supported as of version 0.12.</p>

<p>For more details on the syntax and features of VIC&trade; visit the
<a href="syntax.html">syntax</a> page after you have completed this chapter.</p>

<p>To get you quickly started, here is a quick description of the syntax:</p>

<ul>
<li>there is a Main block that is required</li>
<li>there is a Simulator block that is optional but you can use it to simulate the
 generated PIC&reg; assembly code in a supported simulator like <code>gpsim</code></li>
<li>code generation properties can be manipulated by pragmas</li>
<li>the PIC&reg; MCU selected can be defined by a single line header</li>
<li>blocks are defined using braces <code>{}</code></li>
<li>statements end with a semi-colon <code>;</code></li>
<li>indentation is personal choice and not a forced choice like that of Python</li>
<li>you can have multiple statements on a single line if you want</li>
<li>you can make the code highly readable and follow a set logic</li>
<li>you can get VIC&trade; code to visually match the logic of a flowchart</li>
<li>you can use VIC&trade; as an intermediate language and write even higher level
 code in your favorite language like Perl, Python or Ruby and generate
VIC&trade; code from it.</li>
</ul>

<p>Let us begin with the <em>Hello World!</em> program for the MCU world, which is
lighting up an <a href="https://en.wikipedia.org/wiki/Light-emitting_diode">LED</a>.</p>

<h2 id="helloworld-lightingupanled"><em>Hello World!</em> - Lighting up an LED</h2>

<p>This example is available in the file <code>share/examples/helloworld.vic</code> and also
on the <a href="examples.html#helloworld">examples chapter</a>.</p>

<p>Let us select the PIC&reg; MCU P16F690 that comes with the
<a href="http://www.microchip.com/DevelopmentTools/ProductDetails.aspx?PartNO=DV164120">PICKit&trade; 2 Starter Kit</a>
 from Microchip. From the data sheet of this MCU, we can see the following pin
configuration:</p>

<figure>
<img src="./images/pinout_P16F690.png" alt="Figure 1. P16F690 Pin Diagram" />
<figcaption>Figure 1. P16F690 Pin Diagram</figcaption></figure>

<hr />

<p>Let us select the pin 16, <code>RC0</code>, to which we want to connect an LED to.</p>

<p>Our code will look like this:</p>

<pre><code class="highlight">
<span class="kn">PIC</span> <span class="l">P16F690</span>;
<span class="kd">Main</span> {
    <span class="nf">digital&#95;output</span> <span class="no">RC0</span>;
    <span class="nf">write</span> <span class="no">RC0</span>, <span class="ss">1</span>;
}
</code></pre>

<p><em>That&#8217;s it !</em></p>

<p>Just two lines to light up an LED. And, the code is easy to comprehend.</p>

<ul>
<li>There is <strong>no</strong> need for the developer to know which registers to
manipulate for switching a pin to digital output or input.</li>
<li>There is <strong>no</strong> need to know how to manipulate certain output registers
 to write values to a pin.</li>
<li>All you need to know are the names of the pins which you can get from the pin
 diagram in the MCU&#8217;s data sheet.</li>
</ul>

<h3 id="understandingthecode">Understanding The Code</h3>

<p>Let us go over each line of the above code to see what
they mean.</p>

<ol>
<li><p><code class="highlight"><span class="kn">PIC</span> <span class="l">P16F690</span>;</code></p>

<p>This is the one-line header that defines which PIC&reg; MCU this program is
targeting. It tells the VIC&trade; compiler to verify the pin names that the
user has used in the code, inform the user if they are wrong and generate custom
assembly code for that specific MCU.</p></li>
<li><p><code class="highlight"><span class="kn">Main</span> {</code></p>

<p>This is the beginning of the <strong>main</strong> block of code that will be executed by
the MCU. This is a requirement. You will <em>have</em> to create a <code>Main</code> block.</p></li>
<li><p><code class="highlight"><span class="nf">digital&#95;output</span> <span class="no">RC0</span>;</code></p>

<p>The above describes a way for setting pin <code>RC0</code> of the P16F690
MCU as a digital output. The way MCUs are designed today, each pin can be used
as a digital or analog I/O port at any point of time in the code. Hence, we have
an explicit function to set it. This function will generate the appropriate
assembly instructions to set <code>RC0</code> as a digital output port.</p></li>
<li><p><code class="highlight"><span class="nf">write</span> <span class="no">RC0</span>, <span class="ss">1</span>;</code></p>

<p>This is a very important line. The <code>write</code> function can do various
things. However, in this scenario, we use it to write the value 1 to the pin
<code>RC0</code>. Assuming the LED is connected to <code>RC0</code>, this will set the pin output
to 1 and the LED will turn on.</p></li>
<li><p><code>}</code></p>

<p>The <code>}</code> here denotes the end of the <code>Main</code> block. There is <strong>no</strong> semi-colon needed at the end of
a block.</p></li>
</ol>

<p>For more details on the language syntax descriptions look at the section on <a href="syntax.html">syntax</a>.</p>

<h2 id="simulatingthehelloworldprogram">Simulating the <em>Hello World!</em> program</h2>

<p>VIC&trade; also supports simulation of the code. As of version 0.12, only
<code>gpsim</code> is supported as a simulator. However, more simulators may be added in
the future.</p>

<p>To add a simulation code in VIC&trade;, we add a block titled <code>Simulator</code> as
below. This block has to be added after the <code>Main</code> block in the source file.</p>

<pre><code class="highlight">
<span class="kn">Simulator</span> {
    <span class="nf">attach&#95;led</span> <span class="no">RC0</span>;
    <span class="nf">stop&#95;after</span> <span class="ss">1s</span>;
    <span class="nf">log</span> <span class="no">RC0</span>;
    <span class="nf">logfile</span> <span class="s">"helloworld.lxt"</span>;
    <span class="nf">scope</span> <span class="no">RC0</span>;
}
</code></pre>

<p>Let us look at the above code and analyse what we are doing.</p>

<ol>
<li><p><code class="highlight"><span class="kn">Simulator</span> {</code></p>

<p>This line starts the simulator code block.</p></li>
<li><p><code class="highlight"><span class="nf">attach&#95;led</span> <span class="no">RC0</span>;</code></p>

<p>This line calls the <code>attach_led</code> function to attach an LED to the pin <code>RC0</code>
in the simulator.</p></li>
<li><p><code class="highlight"><span class="nf">stop&#95;after</span> <span class="ss">1s</span>;</code></p>

<p>This line informs the simulator to stop the simulation after the number of
simulated cycles has reached 1 second. Generally, if each instruction cycle takes 1
microsecond to run, then there will be 1 million cycles run by the simulator
before it stops.</p></li>
<li><p><code class="highlight"><span class="nf">log</span> <span class="no">RC0</span>;</code></p>

<p>This line turns on logging of the pin <code>RC0</code>. There are various types of
<a href="./simulator.html#logging">logging options</a> and the default logging is to a text file.</p></li>
<li><p><code class="highlight"><span class="nf">logfile</span> <span class="s">&#8220;helloworld.lxt&#8221;</span>;</code></p>

<p>This line tells the simulator that the logging has to be done in an <code>LXT</code>
format for the <code>gtkwave</code> application to use. The file name that the logging will
be done to is <code>helloworld.lxt</code>, which can then display the waveforms of the
digital outputs using <code>gtkwave</code>.</p></li>
<li><p><code class="highlight"><span class="nf">scope</span> <span class="no">RC0</span>;</code></p>

<p>If the simulator supports displaying a scope, this will show the output pin
<code>RC0</code> on the simulator&#8217;s scope view. This may or may not be necessary if the
user is using the <code>LXT</code> file logging option.</p>

<p>The scope window in <code>gpsim</code> is not very sophisticated, but it does a good job
of real time plotting. For detailed offline analysis, use the logging mechanism
with <code>LXT</code> files and <code>gtkwave</code>.</p></li>
<li><p><code>}</code></p>

<p>The <code>}</code> is always used to close an open block as described in the previous
section.</p></li>
</ol>

<h2 id="savingcodeashelloworld.vic">Saving code as <code>helloworld.vic</code></h2>

<p>Let us save both the above code snippets - the <code>Main</code> block and the <code>Simulator</code>
block into a file called <code>helloworld.vic</code>.</p>

<pre><code class="highlight">
<span class="kn">PIC</span> <span class="l">P16F690</span>;
<span class="kd">Main</span> {
    <span class="nf">digital&#95;output</span> <span class="no">RC0</span>;
    <span class="nf">write</span> <span class="no">RC0</span>, <span class="ss">1</span>;
}
<span class="kn">Simulator</span> {
    <span class="nf">attach&#95;led</span> <span class="no">RC0</span>;
    <span class="nf">stop&#95;after</span> <span class="ss">1s</span>;
    <span class="nf">log</span> <span class="no">RC0</span>;
    <span class="nf">logfile</span> <span class="s">"helloworld.lxt"</span>;
    <span class="nf">scope</span> <span class="no">RC0</span>;
}
</code></pre>

<figure>
<img src="images/HelloworldCode.png" alt="Figure 2. helloworld.vic in a Terminal" />
<figcaption>Figure 2. <code>helloworld.vic</code> in a Terminal</figcaption></figure>

<hr />

<h2 id="buildingthecode">Building the code</h2>

<p>Compiling VIC&trade; code is really easy. To compile the file <code>helloworld.vic</code> we run
the following command:</p>

<pre><code>$ vic helloworld.vic -o helloworld.asm
</code></pre>

<p>This creates the PIC&reg; assembly file that the user can then manipulate further if
they want to. Then the user compiles this the standard way using <code>gputils</code>.</p>

<pre><code>$ gpasm -o helloworld.o helloworld.asm
$ gplink -m -o helloworld.hex helloworld.o
</code></pre>

<p>A sample make file is provided in the source code path
<code>share/examples/GNUmakefile</code> for the user to take advantage of. The makefile is very
generic and the user can just use it for their own VIC&trade; code. It compiles
any file present in the same directory that has the extension <code>.vic</code>.</p>

<h2 id="runningthesimulatorcode">Running the Simulator code</h2>

<p>When compiling with <code>gputils</code> a file with the extension <code>.cod</code> is generated. If
you&#8217;re using the <code>GNUmakefile</code> to compile the code, then a file <code>.stc</code> is also
generated.</p>

<p>The contents of <code>helloworld.stc</code> are pretty simple.</p>

<pre><code>$ cat helloworld.stc
load s helloworld.cod
</code></pre>

<p>The user can manually create this file as well.</p>

<p>This file can be loaded in <code>gpsim</code> using the command:</p>

<pre><code>$ gpsim helloworld.stc
</code></pre>

<p>This will load the <code>helloworld.cod</code> file into the <code>gpsim</code> memory and it is ready to
run. However, the user has to type the <code>run</code> command in <code>gpsim</code> to do that.</p>

<pre><code>gpsim&gt; run
</code></pre>

<p>This will start the simulator run and the user can then view the LED being lit.</p>

<p>Another way to auto-start the simulation is to have the following contents in
the <code>helloworld.stc</code> file. This can avoid the manual <code>run</code> invocation in
<code>gpsim</code>.</p>

<pre><code>$ cat helloworld.stc
load s helloworld.cod
run
</code></pre>

<p>This file can then be loaded in <code>gpsim</code> using the command:</p>

<pre><code>$ gpsim helloworld.stc
</code></pre>

<p>Depending on the task being simulated, you may or may not want an auto-started
simulation.</p>

<figure>
<img src="images/HelloworldSimBefore.png" alt="Figure 3. View of gpsim before run" />
<figcaption>Figure 3. View of <code>gpsim</code> before run</figcaption></figure>

<hr />

<figure>
<img src="images/HelloworldSimAfter.png" alt="Figure 4. View of gpsim after run" />
<figcaption>Figure 4. View of <code>gpsim</code> after run</figcaption></figure>

<hr />

<h2 id="runningthecodeonthepicregitself">Running the code on the PIC&reg; itself</h2>

<p>For the <a href="http://www.microchip.com/pickit2/">PICKit 2 Starter Kit</a>, there is an open source software called
<a href="pk2cmd.html"><code>pk2cmd</code></a>
that can be used on Linux and Mac OS X to copy the <code>.hex</code> file generated onto the
MCU using PICKit 2 Starter Kit. We have <strong>not</strong> tried with the PICKit 3 Starter Kit, but the user can
experiment with Microchip&#8217;s IDE or <a href="http://piklab.sourceforge.net/">Piklab</a> to perform the writing.</p>

<p>The user can also combine the code generated by VIC&trade; with Microchip&#8217;s IDE or Piklab, and use
it that way instead of using <code>gputils</code>. However, we do <strong>not</strong> support Microchip&#8217;s
simulator yet as part of VIC&trade;. We <em>may</em> choose to do it in the future.</p>
    <hr>
    <div id="title">
    <span class="credits left"><a href="./index.html">Table of Contents</a></span>
    <span class="credits right"><a href="hardware.html">Prev</a>&nbsp;&nbsp;<a href="syntax.html">Next</a></span>
    <br/><br/>
    <p style="font-size:14px;">Vikas N Kumar (<a href="https://github.com/vikasnkumar"
class="user-mention">@vikasnkumar</a>) is the author of
<strong>VIC&trade;</strong>. All copyrights belong to the author and Selective
Intellect LLC.</p>
    <p style="font-size:12px;">VIC&trade; is licensed under the <a
    href="http://dev.perl.org/licenses/">license terms of Perl</a>.
    <br/>
    The development of VIC&trade; is sponsored by <a
    href="http://selectiveintellect.com">Selective Intellect LLC.</a>
    </p>
    <p style="font-size:11px;">
        This page was last updated on 2014-10-30 14:52:41 -0400.
    </p>
    </div>
    </section>
    </div><!-- end wrapper -->
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
  </body>
